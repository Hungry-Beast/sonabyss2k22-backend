<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<h2>Events</h2>
	


	<ol>
		<%for(let i of resMainEvents){%>
			<li><%=i.name%></li>
		<%}%>
	</ol>


	<ol>
		<%for(let i of resPreEvents){%>
			<li><%=i.name%></li>
		
			<form action="">
				<input type="text" id="eventId" value="<%=i._id%>" name="i._id">
				<button type="submit" id="register">register</button>
			</form>
		
		
			
		<%}%>
	</ol>


	<script>
		const btn = document.getElementById('register');
		btn.addEventListener('click', async (event) => {
		  event.preventDefault();
		
		  let event_id=document.getElementById('eventId').value;
		  var today = new Date();
		var dd = String(today.getDate()).padStart(2, '0');
		var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
		var yyyy = today.getFullYear();

		today = mm + '/' + dd + '/' + yyyy;
		  const user=JSON.parse(localStorage.getItem('user'))
		  const response = await fetch('/registration', {
			method: 'POST',
			body: JSON.stringify({ eventId:event_id,date:today }),
			headers: { 'Content-Type': 'application/json','Authorization': `Bearer ${user.authToken}`}
		  });
		  const data = await response.json();
		  if (data.success) {
			localStorage.setItem('user',data);
			alert("Success");
		  } else {
			alert('Login failed!');
		  }
		});
	  </script>
		
</body>
</html>


